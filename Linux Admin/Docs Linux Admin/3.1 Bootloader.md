## Bootloader

- Tài liệu này sẽ tóm tắt quá trình boot của một Linux Computer (Intel 32-bit, 64-bit).
- Các hệ thống ngày nay rất ít sử dụng boot với `lilo`. Các Linux system hiện tại chủ yếu được boot với `grub`, nhưng nó không phải là một Linux Project. Các bản phối như `FreeBSD` và `Solaris` cũng sử dụng `grub`.
- Cũng tương tự, `grub` không bị giới hạn với chỉ cấu trúc của Intel mà nó cũng có thể load kernel của các loại cấu trúc khác.
- Hiện tại thì grub gần như đã bị thay thế bằng `grub2` - default bootloader cho các bản phân phối Linux, bao gồm cả Ubuntu.

### Các thuật ngữ với Boot

- Thứ tự chính xác của những điều xảy ra khi khởi động máy tính sẽ phụ thuộc vào kiến trúc phần cứng (Intel, Sun Sparc,..), boot loader (grub, lilo) và hệ điều hành (Linux,Solaris,BSD,...).
- Tài liệu này sẽ tập trung vào boot `Linux` trên cấu trúc `Intel x86` với `grub`.

    ![a](https://imgur.com/T0s3A81.png)

#### post

- Máy tính sẽ bắt đầu booting từ ngay khoảnh khắc mà ta bật nguồn máy. Quá trình này được gọi là `post (power on self test)`. Nếu tất cả đều ok thì nó sẽ đi đến `bios`. Còn nếu không thì ta sẽ có thể không thấy gì, nghe thấy tiếng bíp, thấy thông báo lỗi trên màn hình, hoặc đen nhất là thấy khói :D

#### bios

- Tất cả các máy tính có kiến trúc `Intel x86` đều sẽ có `bios (basic input/output system) để xác định, nhận dạng và khởi tạo hardware.
- Bios sau đó sẽ bắt đầu tìm kiếm `boot device`. Nó có thể là hard disk, cdrom, network card hoặc usb drive.
- Trong quá trình `bios` thì ta có thể thấy thông báo trên màn hình cho biết cần nhấn phím nào để vào thiết lập bios (Del hoặc F2).

#### openboot

- Sun `sparc` system sẽ bắt đầu với `openboot` để test hardware và boot OS. 

#### boot password

- `Bios` cho phép ta có thể đặt mật khẩu. Cố gắng đừng quên mật khẩu này hoặc là ta sẽ phải mở phần cứng ra và reset nó. Điều này giúp cho các cấu hình trong bios không bị thay đổi bởi người khác.

#### boot device

- `bios` sẽ tìm kiếm `boot device` được cấu hình trong bios. Thông thường thì OS sẽ được boot từ hard disk.

#### master boot record

- `mbr` hay `master boot record` là sector đầu tiên của một hard disk. Việc phân vùng các phân vùng chính và các phân vùng active được xác định trong `mbr`.
- `mbr` dài 512 bytes và có thể được sao chép với `dd`
    ```
    dd if=/dev/sda of=bootsect.mbr count=1 bs=512
    ```

#### bootloader

- `mbr` được thực thi bởi `bios` và chứa bootloader (nhỏ) hoặc chứa các code để load `bootloader`.
- Dùng `dd` để xem `mbr` có thể xem thêm thông tin về `bootloader`
    ```
    [root@lab-centos7 ~]# dd if=/dev/sda count=1 bs=16 skip=24 2>/dev/null|od -c
    0000000   G   e   o   m  \0   H   a   r   d       D   i   s   k  \0   R
    0000020
    ```

- Có nhiều loại `bootloader`, phổ biến nhất trên kiến trúc của `intel` là `grub`. Khi cài đặt Linux trên kiến trúc `sparc` thì có thể chọn`silo`, Itanium systems có thể dùng `elilo`, `IBM S/390` và `zSeries` dùng `z/IPL`,...

#### kernel

- Kết quả của tất cả điều này là load được OS hay đúng hơn là load dược `kernel` của OS. Một bootloader thông thường như `grub` sẽ copy kernel từ hardisk tới memory và sau đó chuyển quyền điều khiển máy tính sang kernel.
- Mỗi lần Linux kernel được load, bootloader sẽ chuyển quyền điều khiển sang cho nó. Từ lúc này, kernel sẽ kiểm soát system.

### Grub

